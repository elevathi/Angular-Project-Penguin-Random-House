<div class="container mt-4">
      <!-- Dynamic heading based on mode -->
      @if (searchType === 'authors' || searchType === 'titles') {
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="mb-0">
            <i class="bi bi-search me-2"></i>Iskanje
          </h2>
          <div class="d-flex gap-2 align-items-center">
            <!-- I'm feeling lucky button -->
            <button type="button" class="btn btn-outline-warning"
              (click)="feelingLucky()"
              [disabled]="isLoadingLucky">
              @if (isLoadingLucky) {
                <span class="spinner-border spinner-border-sm me-1"></span>
              } @else {
                <i class="bi bi-dice-5 me-1"></i>
              }
              Naključna knjiga
            </button>
            <!-- Toggle between author/title search -->
            <div class="btn-group" role="group">
              <button type="button" class="btn"
                [class.btn-primary]="searchType === 'authors'"
                [class.btn-outline-primary]="searchType !== 'authors'"
                (click)="switchTab('authors')">
                <i class="bi bi-people me-1"></i>Avtorji
              </button>
              <button type="button" class="btn"
                [class.btn-primary]="searchType === 'titles'"
                [class.btn-outline-primary]="searchType !== 'titles'"
                (click)="switchTab('titles')">
                <i class="bi bi-book me-1"></i>Naslovi
              </button>
            </div>
          </div>
        </div>

        <!-- Lucky Title Card -->
        @if (luckyTitle) {
          <div class="card border-warning mb-4 shadow-sm">
            <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
              <span><i class="bi bi-dice-5 me-2"></i>Naključna knjiga</span>
              <button type="button" class="btn-close" (click)="dismissLucky()"></button>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-auto">
                  <img [src]="'https://images.randomhouse.com/cover/' + luckyTitle.isbn"
                       [alt]="luckyTitle.titleweb"
                       class="img-fluid rounded lucky-cover"
                       (error)="$any($event.target).src = 'assets/no-cover.svg'">
                </div>
                <div class="col">
                  <h5 class="card-title">{{ luckyTitle.titleweb }}</h5>
                  <p class="card-text text-muted mb-2">{{ luckyTitle.authorweb }}</p>
                  @if (luckyTitle.subjectcategorydescription1) {
                    <span class="badge bg-secondary me-1">{{ luckyTitle.subjectcategorydescription1 }}</span>
                  }
                  @if (luckyTitle.formatname) {
                    <span class="badge bg-info">{{ luckyTitle.formatname }}</span>
                  }
                </div>
                <div class="col-auto d-flex flex-column gap-2">
                  <button type="button" class="btn btn-primary" (click)="viewLuckyTitle()">
                    <i class="bi bi-eye me-1"></i>Oglej si
                  </button>
                  <button type="button" class="btn btn-outline-warning" (click)="feelingLucky()">
                    <i class="bi bi-arrow-repeat me-1"></i>Nova
                  </button>
                </div>
              </div>
            </div>
          </div>
        }
      }

      <!-- Search Form Component (only show for search tabs) -->
      @if (searchType === 'authors' || searchType === 'titles') {
        <app-search-form
          #searchForm
          [searchType]="searchType"
          [isLoading]="isLoading"
          (authorSearch)="onAuthorSearch($event)"
          (titleSearch)="onTitleSearch($event)">
        </app-search-form>
      }

      <!-- Loading -->
      @if (isLoading) {
        <app-loader></app-loader>
      }

      <!-- Error -->
      @if (errorMessage) {
        <div class="alert alert-danger">
          <i class="bi bi-exclamation-triangle me-2"></i>
          {{ errorMessage }}
        </div>
      }

      <!-- No Results -->
      @if (!isLoading && hasSearched && !errorMessage) {
        @if (searchType === 'authors' && authors.length === 0) {
          <div class="alert alert-info">
            <i class="bi bi-info-circle me-2"></i>
            Ni najdenih avtorjev.
          </div>
        }
        @if (searchType === 'titles' && titles.length === 0) {
          <div class="alert alert-info">
            <i class="bi bi-info-circle me-2"></i>
            Ni najdenih naslovov.
          </div>
        }
      }

      <!-- Author Results -->
      @if (searchType === 'authors' && authors.length > 0) {
        <h5 class="mb-3">
          <i class="bi bi-check-circle text-success me-2"></i>
          Najdeni avtorji ({{ authors.length }})
        </h5>
        <div class="row g-3">
          @for (author of paginatedSearchAuthors; track author.authorid) {
            <div class="col-md-6 col-lg-4">
              <app-author-card
                [author]="author"
                (authorSelected)="onAuthorSelected($event)">
              </app-author-card>
            </div>
          }
        </div>

        <!-- Pagination for Search Authors -->
        <app-pagination
          [currentPage]="searchAuthorsCurrentPage"
          [totalPages]="totalSearchAuthorsPages"
          (pageChange)="changeSearchAuthorsPage($event)">
        </app-pagination>
      }

      <!-- Title Results -->
      @if (searchType === 'titles' && titles.length > 0) {
        <h5 class="mb-3">
          <i class="bi bi-check-circle text-success me-2"></i>
          Najdeni naslovi ({{ titles.length }})
        </h5>
        <div class="row g-3">
          @for (title of paginatedSearchTitles; track title.isbn) {
            <div class="col-md-6">
              <app-title-card
                [title]="title"
                (titleSelected)="onTitleSelected($event)">
              </app-title-card>
            </div>
          }
        </div>

        <!-- Pagination for Search Titles -->
        <app-pagination
          [currentPage]="searchTitlesCurrentPage"
          [totalPages]="totalSearchTitlesPages"
          (pageChange)="changeSearchTitlesPage($event)">
        </app-pagination>
      }

      <!-- All Authors Tab -->
      @if (searchType === 'all-authors') {
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">
            <i class="bi bi-people-fill text-primary me-2"></i>
            Vsi avtorji ({{ totalAuthorsCount | number }})
            @if (isLoadingAuthorsPage) {
              <span class="text-muted small ms-2">
                <span class="spinner-border spinner-border-sm" role="status"></span>
              </span>
            }
          </h5>
          <span class="text-muted small">
            Stran {{ allAuthorsCurrentPage }} od {{ totalAuthorsPages | number }}
          </span>
        </div>

        @if (currentAuthorsPage.length === 0 && isLoadingAuthorsPage) {
          <app-loader></app-loader>
        } @else if (currentAuthorsPage.length === 0 && !isLoadingAuthorsPage) {
          <div class="alert alert-info">
            <i class="bi bi-info-circle me-2"></i>
            Ni avtorjev za prikaz.
          </div>
        } @else {
          <div class="row g-3" [class.opacity-50]="isLoadingAuthorsPage" [style.pointer-events]="isLoadingAuthorsPage ? 'none' : 'auto'">
            @for (author of currentAuthorsPage; track author.authorid) {
              <div class="col-md-6 col-lg-4">
                <app-author-card
                  [author]="author"
                  (authorSelected)="onAuthorSelected($event)">
                </app-author-card>
              </div>
            }
          </div>

          <!-- Pagination for Authors -->
          @if (totalAuthorsPages > 1) {
            <div [class.opacity-50]="isLoadingAuthorsPage" [style.pointer-events]="isLoadingAuthorsPage ? 'none' : 'auto'">
              <app-pagination
                [currentPage]="allAuthorsCurrentPage"
                [totalPages]="totalAuthorsPages"
                (pageChange)="changeAuthorsPage($event)">
              </app-pagination>
            </div>
          }
        }
      }

      <!-- All Titles Tab -->
      @if (searchType === 'all-titles') {
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">
            <i class="bi bi-book-fill text-primary me-2"></i>
            Vsi naslovi ({{ totalTitlesCount | number }})
            @if (isLoadingTitlesPage) {
              <span class="text-muted small ms-2">
                <span class="spinner-border spinner-border-sm" role="status"></span>
              </span>
            }
          </h5>
          <span class="text-muted small">
            Stran {{ allTitlesCurrentPage }} od {{ totalTitlesPages | number }}
          </span>
        </div>

        @if (currentTitlesPage.length === 0 && isLoadingTitlesPage) {
          <app-loader></app-loader>
        } @else if (currentTitlesPage.length === 0 && !isLoadingTitlesPage) {
          <div class="alert alert-info">
            <i class="bi bi-info-circle me-2"></i>
            Ni naslovov za prikaz.
          </div>
        } @else {
          <div class="row g-3" [class.opacity-50]="isLoadingTitlesPage" [style.pointer-events]="isLoadingTitlesPage ? 'none' : 'auto'">
            @for (title of currentTitlesPage; track title.isbn) {
              <div class="col-md-6">
                <app-title-card
                  [title]="title"
                  (titleSelected)="onTitleSelected($event)">
                </app-title-card>
              </div>
            }
          </div>

          <!-- Pagination for Titles -->
          @if (totalTitlesPages > 1) {
            <div [class.opacity-50]="isLoadingTitlesPage" [style.pointer-events]="isLoadingTitlesPage ? 'none' : 'auto'">
              <app-pagination
                [currentPage]="allTitlesCurrentPage"
                [totalPages]="totalTitlesPages"
                (pageChange)="changeTitlesPage($event)">
              </app-pagination>
            </div>
          }
        }
      }

    </div>